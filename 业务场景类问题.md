# 大量的关注/粉丝设计

设计表结构，关注了就增加关注与被关注记录。此时考虑的单条记录的其他属性

水平拆分->按主键取模，确定表

垂直拆分->分为关注表与被关注表

考虑业务场景下的优化，分数数量直接成为字段之一，业务上禁止查询。

# 对于很多的待做的事情

专门的数据库表来记录，然后定时处理

MQ的定时消息

# 秒杀

动静分离，将静态资源部署到CDN上。极少数允许动态请求

页面按钮先置为灰色

读多写少，使用Redis作预先缓存。存在缓存击穿的问题（建议先预热）。存在缓存穿透，大量的直接穿透访问。缓存雪崩，缓存大量同时过期。在Redis之前再来一份分布式锁大量请求数据库 。->自旋锁

库存不足和库存超卖和回退库存

下单等利用MQ解耦，解决消息丢失（落表，等生产者来写），消息重复（落表，回写生产者），垃圾消息（重试次数）。

限流，nginx（IP，用户），验证码，接口限流。调整业务规则

**
2、用IN来替换OR**

**1、尽量避免使用子查询**

**3、读取适当的记录LIMIT M,N，而不要读多余的记录**
4、禁止不必要的Order By排序**

**5、总和查询可以禁止排重用union all**
6、避免随机取记录**

**7、将多次插入换成批量Insert插入**

**8、只返回必要的列，用具体的字段列表代替 select \* 语句**
9、区分in和exists**

**10、优化Group By语句****11、尽量使用数字型字段**

**、索引的优化/如何避免索引失效**



**2、不在索引列上做任何操作**

