# 缓存更新策略

## redis 缓存更新策略

> 隐含背景是正常缓存读取是读操作未命中，则读数据库然后更新缓存信息。由此可以看出让写线程更新缓存很大概率上会造成缓存与数据库数据不一致的情况
>
> 缓存删除后，理由读线程会读取数据库再更新缓存的特点，实现缓存和数据库同步，故建议对于缓存只需要删除操作即可
>
> 这几种策略，综合考虑双写和单读的情况，即可分析出利弊

### 先更新缓存后更新数据库

更新缓存速度快，更新数据库速度慢。当存在多个线程并发更新数据库，缓存和数据库的更新不具有原子性

### 先更新数据库再更新缓存

同先更新缓存再更新数据库同样的问题

### 先删除缓存在更新数据库

更新缓存速度快，更新数据库操作慢。先删除缓存，主动造成较长时间的不一致，而且由于利用读设置新缓存，会造成永久不一致。

### 先更新数据库在删除缓存

更新完之后再删除，比较完美。

### 终极解决方案

手动重试-> 在删除缓存失败后，将消息存入消息中间件中。可以额外消费消息。不断重试

框架重试-> 应用程序订阅数据库的binlog日志，搭配消息中间件，不断重试

# Redis 数据结构及其应用场景

